!function(t,e){"function"==typeof define&&define.amd?define([],function(){return t.SignaturePad=e()}):"object"==typeof exports?module.exports=e():t.SignaturePad=e()}(this,function(){return function(t){"use strict";var e=function(t,e){var o=this,n=e||{};this.velocityFilterWeight=n.velocityFilterWeight||.7,this.minWidth=n.minWidth||.5,this.maxWidth=n.maxWidth||2.5,this.dotSize=n.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=n.penColor||"black",this.backgroundColor=n.backgroundColor||"rgba(0,0,0,0)",this.onEnd=n.onEnd,this.onBegin=n.onBegin,this._canvas=t,this._ctx=t.getContext("2d"),this.clear(),this._handleMouseDown=function(t){1===t.which&&(o._mouseButtonDown=!0,o._strokeBegin(t))},this._handleMouseMove=function(t){o._mouseButtonDown&&o._strokeUpdate(t)},this._handleMouseUp=function(t){1===t.which&&o._mouseButtonDown&&(o._mouseButtonDown=!1,o._strokeEnd(t))},this._handleTouchStart=function(t){if(1==t.targetTouches.length){var e=t.changedTouches[0];o._strokeBegin(e)}},this._handleTouchMove=function(t){t.preventDefault();var e=t.targetTouches[0];o._strokeUpdate(e)},this._handleTouchEnd=function(t){t.target===o._canvas&&(t.preventDefault(),o._strokeEnd(t))},this._handleMouseEvents(),this._handleTouchEvents()};e.prototype.clear=function(){var t=this._ctx,e=this._canvas;t.fillStyle=this.backgroundColor,t.clearRect(0,0,e.width,e.height),t.fillRect(0,0,e.width,e.height),this._reset()},e.prototype.toDataURL=function(t,e){var o=this._canvas;return o.toDataURL.apply(o,arguments)},e.prototype.fromDataURL=function(t){var e=this,o=new Image,n=window.devicePixelRatio||1,i=this._canvas.width/n,s=this._canvas.height/n;this._reset(),o.src=t,o.onload=function(){e._ctx.drawImage(o,0,0,i,s)},this._isEmpty=!1},e.prototype._strokeUpdate=function(t){var e=this._createPoint(t);this._addPoint(e)},e.prototype._strokeBegin=function(t){this._reset(),this._strokeUpdate(t),"function"==typeof this.onBegin&&this.onBegin(t)},e.prototype._strokeDraw=function(t){var e=this._ctx,o="function"==typeof this.dotSize?this.dotSize():this.dotSize;e.beginPath(),this._drawPoint(t.x,t.y,o),e.closePath(),e.fill()},e.prototype._strokeEnd=function(t){var e=this.points.length>2,o=this.points[0];!e&&o&&this._strokeDraw(o),"function"==typeof this.onEnd&&this.onEnd(t)},e.prototype._handleMouseEvents=function(){this._mouseButtonDown=!1,this._canvas.addEventListener("mousedown",this._handleMouseDown),this._canvas.addEventListener("mousemove",this._handleMouseMove),t.addEventListener("mouseup",this._handleMouseUp)},e.prototype._handleTouchEvents=function(){this._canvas.style.msTouchAction="none",this._canvas.addEventListener("touchstart",this._handleTouchStart),this._canvas.addEventListener("touchmove",this._handleTouchMove),t.addEventListener("touchend",this._handleTouchEnd)},e.prototype.on=function(){this._handleMouseEvents(),this._handleTouchEvents()},e.prototype.off=function(){this._canvas.removeEventListener("mousedown",this._handleMouseDown),this._canvas.removeEventListener("mousemove",this._handleMouseMove),t.removeEventListener("mouseup",this._handleMouseUp),this._canvas.removeEventListener("touchstart",this._handleTouchStart),this._canvas.removeEventListener("touchmove",this._handleTouchMove),t.removeEventListener("touchend",this._handleTouchEnd)},e.prototype.isEmpty=function(){return this._isEmpty},e.prototype._reset=function(){this.points=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._isEmpty=!0,this._ctx.fillStyle=this.penColor},e.prototype._createPoint=function(t){var e=this._canvas.getBoundingClientRect();return new o(t.clientX-e.left,t.clientY-e.top)},e.prototype._addPoint=function(t){var e,o,i,s=this.points;s.push(t),s.length>2&&(3===s.length&&s.unshift(s[0]),e=this._calculateCurveControlPoints(s[0],s[1],s[2]).c2,o=this._calculateCurveControlPoints(s[1],s[2],s[3]).c1,i=new n(s[1],e,o,s[2]),this._addCurve(i),s.shift())},e.prototype._calculateCurveControlPoints=function(t,e,n){var i=t.x-e.x,s=t.y-e.y,h=e.x-n.x,r=e.y-n.y,a=(t.x+e.x)/2,c=(t.y+e.y)/2,u=(e.x+n.x)/2,d=(e.y+n.y)/2,l=Math.sqrt(i*i+s*s),_=Math.sqrt(h*h+r*r),p=_/(l+_),v=u+(a-u)*p,f=d+(c-d)*p,y=e.x-v,m=e.y-f;return{c1:new o(a+y,c+m),c2:new o(u+y,d+m)}},e.prototype._addCurve=function(t){var e,o,n=t.startPoint;e=t.endPoint.velocityFrom(n),e=this.velocityFilterWeight*e+(1-this.velocityFilterWeight)*this._lastVelocity,o=this._strokeWidth(e),this._drawCurve(t,this._lastWidth,o),this._lastVelocity=e,this._lastWidth=o},e.prototype._drawPoint=function(t,e,o){var n=this._ctx;n.moveTo(t,e),n.arc(t,e,o,0,2*Math.PI,!1),this._isEmpty=!1},e.prototype._drawCurve=function(t,e,o){var n,i,s,h,r,a,c,u,d,l,_,p=this._ctx,v=o-e;for(n=Math.floor(t.length()),p.beginPath(),s=0;s<n;s++)a=(r=(h=s/n)*h)*h,l=(d=(u=(c=1-h)*c)*c)*t.startPoint.x,l+=3*u*h*t.control1.x,l+=3*c*r*t.control2.x,l+=a*t.endPoint.x,_=d*t.startPoint.y,_+=3*u*h*t.control1.y,_+=3*c*r*t.control2.y,_+=a*t.endPoint.y,i=e+a*v,this._drawPoint(l,_,i);p.closePath(),p.fill()},e.prototype._strokeWidth=function(t){return Math.max(this.maxWidth/(t+1),this.minWidth)};var o=function(t,e,o){this.x=t,this.y=e,this.time=o||(new Date).getTime()};o.prototype.velocityFrom=function(t){return this.time!==t.time?this.distanceTo(t)/(this.time-t.time):1},o.prototype.distanceTo=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))};var n=function(t,e,o,n){this.startPoint=t,this.control1=e,this.control2=o,this.endPoint=n};return n.prototype.length=function(){var t,e,o,n,i,s,h,r,a=0;for(t=0;t<=10;t++)e=t/10,o=this._point(e,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),n=this._point(e,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y),t>0&&(h=o-i,r=n-s,a+=Math.sqrt(h*h+r*r)),i=o,s=n;return a},n.prototype._point=function(t,e,o,n,i){return e*(1-t)*(1-t)*(1-t)+3*o*(1-t)*(1-t)*t+3*n*(1-t)*t*t+i*t*t*t},e}(document)});